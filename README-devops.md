## Overview

The Talkable documentation stack is a containerized system that uses Docker to simplify deployment and management. It is designed to generate, serve, and manage static documentation across multiple environments, such as staging and production.

## Key Features

1. **Containerized Components**:
   
   - **Nginx**: Handles HTTP requests, serves static HTML files, manages URL redirection, and dynamically serves environment-specific `robots.txt` files.
   - **Sphinx Autobuilder**: Generates static HTML files from source documentation and stores them in a persistent volume shared with Nginx.

2. **Environment-Specific Behavior**:
   
   - Configured via a `.env` file for flexibility.
   - Supports dynamic environment-specific behavior, such as serving different `robots.txt` files based on the `ENVIRONMENT` variable.

3. **Efficient Architecture**:
   
   - Deployed on Amazon AWS Virtual Private Servers (VPS) with an AWS load balancer directing user traffic to the appropriate environment.
   - Sphinx generates content on a persistent volume that Nginx serves directly.

## Deployment Process

### Prerequisites

- Ensure Docker and Docker Compose are installed on the target VPS.
- Clone the repository containing the stack configuration.

### Steps

1. **Clone the Repository**:
   
   ```bash
   git clone git@github.com:talkable/talkable-docs.git
   ```

2. **Switch to the Appropriate Branch**:
   
   - Use the `master` branch for production.
   
      ```bash
      git checkout master
      ```
   
   - Use the `staging` branch for staging.
   
      ```bash
      git checkout staging
      ```

3. **Create and Configure the `.env` File**:
   
   - Copy `.env.template` to `.env`:
   
     ```bash
     cp .env.template .env
     ```
   
   - Update the following variables:
  
     - **`ENVIRONMENT`**: Set to `development`, `staging`, or `production`.
     - **`LOCAL_PORT`**: Adjust if the default port (`8080`) is already in use.
     - Leave `_HOST` variables unchanged unless domain names for staging or production servers are updated.

4. **Deploy the Stack**:
   
   ```bash
   docker compose up -d --build
   ```

## Environment-Specific Configuration

### Handling `robots.txt`

- The repository includes separate `robots.txt` files for each environment.
- The correct file is dynamically selected based on the `ENVIRONMENT` variable and mapped to the container:
  
  ```yaml
  volumes:
    - ./nginx/robots/${ENVIRONMENT}.txt:/var/www/robots.txt
  ```

- Nginx serves the file at `/var/www/robots.txt` in response to `robots.txt` requests.

## Persistent Data Sharing

- **Static HTML Files**:
  - Generated by Sphinx and stored in a shared volume.
  - Served by Nginx without regeneration.

- **Volume Management**:
  - Shared volumes allow seamless access and updates between containers.
  - Ensures efficient and consistent behavior across environments.
